<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>VoltHome — Экспликация</title>
    <style>
        @page { size: A4; margin: 14mm; }
        :root { --text:#111; --muted:#666; --line:#e9e9e9; }
        html,body { padding:0; margin:0; }
        body {
          font-family: "Noto Sans", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
          font-size: 11.5pt; color: var(--text);
          -webkit-print-color-adjust: exact;
        }

        /* ШАПКА */
        .header{display:flex;align-items:center;gap:14pt;margin-bottom:10pt;}
        .header__logo{width:42pt;height:42pt;object-fit:contain}
        .header__title{font-size:18pt;font-weight:700;line-height:1.1}

        /* Заголовки + KPI */
        h2{font-size:13.5pt;margin:14pt 0 6pt}
        .h2-tight{margin-top:6pt;margin-bottom:6pt;}
        .kpi{margin:2pt 0 10pt;line-height:1.35}
        .muted{color:var(--muted)}
        .divider{height:1px;background:var(--line);margin:8pt 0 2pt;}

        /* Форсированный разрыв страницы */
        .pagebreak{
          page-break-before: always;   /* старое имя */
          break-before: page;          /* новое имя (современные браузеры) */
          height:0; line-height:0; margin:0; padding:0; border:0;
        }

        /* Таблицы компактнее */
        .table{width:100%;border-collapse:collapse}
        .table td{padding:5pt 6pt;vertical-align:top}
        .chip{display:inline-block;padding:2pt 7pt;border-radius:7pt;border:1px solid #d8d8d8;background:#fafafa;font-size:10pt}
        .li{margin:2pt 0}

        /* Переносы/разрывы (мягкие) */
        .section{ page-break-inside:auto; break-inside:auto; }
        .table tr{ page-break-inside:avoid; break-inside:avoid; }

        /* ВОДЯНОЙ ЗНАК */
        .watermark{
          position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
          pointer-events:none; opacity:.06;
        }
        .watermark img{width:60%; max-width:480px; object-fit:contain}

        /* ФУТЕР */
        .footer{
          position:fixed; left:14mm; right:14mm; bottom:10mm;
          display:flex; justify-content:space-between; align-items:center;
          font-size:9.5pt; color:var(--muted)
        }
        .footer .line{position:absolute;left:0;right:0;top:-6mm;height:1px;background:var(--line)}
    </style>

    <!-- локальный шрифт (если используешь) -->
    <link rel="preload" href="file:///android_asset/fonts/NotoSans-Regular.ttf" as="font" type="font/ttf" crossorigin>
    <style>
        @font-face{
          font-family:"Noto Sans";
          src:url("file:///android_asset/fonts/NotoSans-Regular.ttf");
          font-weight:normal; font-style:normal;
        }
    </style>
</head>
<body>

{{#watermark}}
<div class="watermark">
    <img src="img/logo.png" alt="VoltHome"/>
</div>
{{/watermark}}

<!-- ШАПКА -->
<div class="header">
    <img class="header__logo" src="img/logo.png" alt="VoltHome"/>
    <div class="header__title">VoltHome — Экспликация</div>
</div>

<!-- KPI -->
<div class="kpi">
    <div>Дата: <b>{{date}}</b></div>
    <div>Вводной аппарат: <b>{{incomer}}</b></div>
    <div>Всего групп: <b>{{totalGroups}}</b></div>
    <div>Суммарный ток: <b>{{totalCurrent}} А</b></div>
    <div>Токи по фазам: <b>A: {{iA}} А · B: {{iB}} А · C: {{iC}} А</b></div>
</div>

{{#donut}}
<h2>Распределение нагрузки по фазам</h2>
<img src="{{donut}}" alt="Диаграмма фаз" style="max-width:100%;"/>
{{/donut}}

<div class="divider"></div>

<!-- Жёстко начинаем новую страницу для экспликации -->
<div class="pagebreak"></div>
<h2 class="h2-tight">Экспликация по фазам</h2>

{{#phases}}
<div class="section">
    <h2>{{name}}</h2>
    <table class="table">
        {{rows}}
    </table>
</div>
{{/phases}}

<!-- ФУТЕР -->
<div class="footer">
    <div class="line"></div>
    <div>VoltHome</div>
    <div class="muted">Отчёт сгенерирован: {{date}}</div>
</div>

</body>
</html>